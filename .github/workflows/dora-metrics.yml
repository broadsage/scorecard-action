name: DORA Metrics Collection

on:
  schedule:
    - cron: '0 6 * * 1'
  workflow_dispatch:

permissions:
  contents: read
  issues: write
  pull-requests: read

jobs:
  dora-metrics:
    name: Collect DORA Metrics
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v5
        
      - name: DevOps Metrics from GitHub
        id: dora  
        uses: stenjo/devops-metrics-action@v1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          repo: ${{ github.repository }}
        continue-on-error: true
          
      - name: Display Results  
        if: always()
        run: |
          echo "üìä DORA Metrics Collection"
          echo "========================="
          if [[ "${{ steps.dora.outcome }}" == "success" ]]; then
            echo "‚úÖ DORA metrics collection completed successfully"
            echo "üìà Check the action logs above for detailed metrics"
            echo "üîç Metrics include: Deploy Frequency, Lead Time, Change Failure Rate, and MTTR"
            echo ""
            echo "üìã Using industry-standard marketplace action: stenjo/devops-metrics-action@v1"
            echo "ÔøΩ Metrics are calculated based on releases, PRs, and issue data"
          else
            echo "‚ö†Ô∏è Metrics collection encountered issues"
            echo "ÔøΩ Possible reasons:"
            echo "   - Repository may not have enough historical data"
            echo "   - Insufficient releases, issues, or pull requests"
            echo "   - Network or API rate limiting issues"
            echo ""
            echo "üîß To improve metrics accuracy:"
            echo "   - Ensure regular releases are created"
            echo "   - Use issues to track bugs and incidents"  
            echo "   - Maintain consistent PR workflow"
          fi
